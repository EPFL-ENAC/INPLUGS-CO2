@layer components {
  .navbar-nav {
    a {
      color: var(--canard);
      font-family: var(--font-family-system);
      font-size: 1.5625rem;
      font-style: normal;
      font-weight: 400;
      line-height: normal;
      letter-spacing: -0.04688rem;
      text-decoration: none;
      opacity: 0.9;
      padding: 0 0.4rem;
      border-radius: 6px;

      display: flex;
      align-self: stretch;
      height: 100%;
      align-items: center;
      white-space: nowrap; /* prevent multi-line wrapping */
      flex: 0 0 auto; /* avoid shrinking that could force wrap */

      /* Smooth transitions */
      transition:
        opacity 0.2s ease,
        background-color 0.2s ease,
        transform 0.2s ease;

      /* Progressive font enhancement */
      .fonts-loaded-1 & {
        font-family: var(--font-family-primary);
      }

      &:hover,
      &:focus-visible {
        opacity: 1;
        outline: none;
        background: color-mix(in oklab, var(--brand-fg) 12%, transparent);
      }

      &[aria-current="page"] {
        text-decoration: none;
        font-style: normal;
        font-weight: 700;
        line-height: normal;
      }
    }
  }

  /* Custom dropdowns */
  .nav-item-dropdown {
    position: relative;
    display: inline-block;
    height: 100%;
  }

  .nav-dropdown-toggle {
    color: var(--canard);
    font-size: 1.5625rem;
    font-style: normal;
    font-weight: 400;
    line-height: normal;
    letter-spacing: -0.04688rem;
    text-decoration: none;
    opacity: 0.9;
    padding: 0 0.4rem;
    border-radius: 6px;
    background: none;
    border: none;
    cursor: pointer;
    white-space: nowrap;
    flex: 0 0 auto;

    display: flex;
    align-self: stretch;
    height: 100%;
    align-items: center;
    gap: 0.25rem;

    /* Progressive font enhancement */
    .fonts-loaded-1 & {
      font-family: var(--font-family-primary);
    }

    &:hover,
    &:focus-visible {
      opacity: 1;
      outline: none;
      background: color-mix(in oklab, var(--brand-fg) 12%, transparent);
    }

    &:focus-visible {
      outline: 2px solid var(--canard);
      outline-offset: 2px;
    }

    &[aria-current="page"] {
      text-decoration: none;
      font-style: normal;
      font-weight: 700;
      line-height: normal;
    }
  }

  .nav-dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;

    /* Background with fallback */
    background: rgba(244, 240, 235, 0.8);
    background: color-mix(in srgb, var(--navbar-bg) 80%, transparent);

    /* Backdrop filter with fallbacks */
    -webkit-backdrop-filter: blur(12px) saturate(120%);
    backdrop-filter: blur(12px) saturate(120%);

    /* Ensure proper layering */
    isolation: isolate;
    z-index: 1000;

    box-shadow: var(--shadow);
    border-radius: var(--radius);
    padding: var(--space-2);
    min-width: 200px;

    /* Animation */
    opacity: 0;
    transform: translateY(-10px) translateX(var(--dropdown-left-position, 0px))
      scale(0.95);
    transition:
      opacity 0.2s ease,
      transform 0.2s ease,
      visibility 0.2s;
    visibility: hidden;

    &.dropdown-active {
      display: flex;
      flex-direction: column;
      opacity: 1;
      transform: translateY(0) translateX(var(--dropdown-left-position, 0px))
        scale(1);
      visibility: visible;
    }
  }

  .nav-dropdown-item {
    display: block;
    padding: var(--space-2);
    color: var(--canard);
    text-decoration: none;
    border-radius: 6px;
    font-size: 1.25rem;
    white-space: nowrap;
    margin: 0.25rem 0;

    &:hover,
    &:focus-visible {
      background: color-mix(in oklab, var(--brand-fg) 12%, transparent);
      backdrop-filter: blur(10px);
    }

    &[aria-current="page"] {
      font-weight: 700;
    }
  }

  /* More dropdown button */
  .nav-more-dropdown {
    /* Default: hide them in dropdown, show only in nav bar */
    .nav-contact,
    .nav-about,
    .nav-links,
    .nav-dictionary,
    .nav-education {
      display: none;
    }

    /* Contact */
    @media (max-width: 1300px) {
      .nav-contact {
        display: block;
      }
    }

    /* About */
    @media (max-width: 1250px) {
      .nav-about {
        display: block;
      }
    }

    /* Links */
    @media (max-width: 1180px) {
      .nav-links {
        display: block;
      }
    }

    /* Dictionary */
    @media (max-width: 1020px) {
      .nav-dictionary {
        display: block;
      }
    }

    /* Education */
    @media (max-width: 900px) {
      .nav-education {
        display: block;
      }
    }
  }

  .nav-more {
    position: relative;
    display: inline-block;

    .nav-more-toggle {
      color: var(--canard);
      font-family: var(--font-family-system);
      font-size: 1.5625rem;
      font-style: normal;
      font-weight: 400;
      line-height: normal;
      letter-spacing: -0.04688rem;
      text-decoration: none;
      opacity: 0.9;
      padding: 0 0.4rem;
      border-radius: 6px;
      background: none;
      border: none;
      cursor: pointer;
      white-space: nowrap; /* ensure consistency with nav links */
      flex: 0 0 auto;

      display: flex;
      align-self: stretch;
      height: 100%;
      align-items: center;
      gap: 0.25rem;

      /* Progressive font enhancement */
      .fonts-loaded-1 & {
        font-family: var(--font-family-primary);
      }

      &:hover,
      &:focus-visible {
        opacity: 1;
        outline: none;
        background: color-mix(in oklab, var(--brand-fg) 12%, transparent);
        backdrop-filter: blur(10px);
      }

      &:focus-visible {
        outline: 2px solid var(--canard);
        outline-offset: 2px;
        backdrop-filter: blur(10px);
      }

      &[aria-expanded="true"] {
        opacity: 1;
        background: color-mix(in oklab, var(--brand-fg) 12%, transparent);
        backdrop-filter: blur(10px);
      }
    }

    .nav-more-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--navbar-bg);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      padding: var(--space-2);
      min-width: 200px;
      z-index: 1000;
      display: none;

      /* Animation properties */
      opacity: 0;
      transform: translateY(-10px);
      transition:
        opacity 0.2s ease,
        transform 0.2s ease,
        visibility 0.2s;
      visibility: hidden;

      a {
        display: block;
        padding: var(--space-2);
        color: var(--canard);
        text-decoration: none;
        border-radius: 6px;
        font-size: 1.25rem;
        white-space: nowrap;

        &:hover,
        &:focus-visible {
          background: color-mix(in oklab, var(--brand-fg) 12%, transparent);
        }

        &[aria-current="page"] {
          font-weight: 700;
        }
      }

      .nav-more:hover &,
      .nav-more:focus-within & {
        display: flex;
        flex-direction: column;
        opacity: 1;
        transform: translateY(0);
        visibility: visible;
      }

      &.open {
        display: flex;
        opacity: 1;
        transform: translateY(0);
        visibility: visible;
      }
    }

    /* Large desktop: Show all navigation items */
    @media (min-width: 1400px) {
      display: none !important;

      ~ .navbar-nav a[data-priority] {
        display: flex !important;
      }
    }

    /* Medium screens: Show priority items + More dropdown */
    @media (max-width: 1399px) and (min-width: 1025px) {
      display: flex;

      ~ .navbar-nav a[data-priority="secondary"] {
        display: none;
      }
    }

    /* Tablet: Show fewer priority items + More dropdown */
    @media (max-width: 1024px) and (min-width: 769px) {
      display: flex;

      ~ .navbar-nav a[data-priority="secondary"],
      ~ .navbar-nav a[data-priority="tertiary"] {
        display: none;
      }
    }
  }
}
