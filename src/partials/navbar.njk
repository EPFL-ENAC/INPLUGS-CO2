<div class="navbar">
    <link rel="stylesheet" href='{{ asset("/assets/styles/navbar.css") }}'>
    <header class="navbar__container">
        <a href="/{{ locale }}/" class="navbar__logo-link" aria-label="Go to homepage">
            <picture class="navbar__logo">
                <!-- WebP source -->
                <source type="image/webp" srcset="{{ asset(" /assets/images/logo/logo_inplugs_86x68.webp") }}">
                <!-- PNG fallback -->
                <img src="{{ asset(" /assets/images/logo/logo_inplugs_86x68.png") }}" alt="INPLUGS Logo" width="86"
                    height="68">
            </picture>
        </a>
        <nav aria-label="Main navigation" class="navbar__nav">
            {% set navOrder = [] %}
            {% for item in navItems %}
            {% if not item.hidden %}
            {% set _ = navOrder.push(item.key) %}
            {% if item.anchors !== undefined %}
            <!-- Nav item with dropdown -->
            <div
                class="navbar__dropdown navbar__dropdown--{{ item.key }} navbar__item--{{ item.key }} {% if 'align' in item %}navbar__item--{{ item.align }}{% endif %}">
                <button class="navbar__dropdown-toggle" {% if page.key==item.key
                    %}aria-current="page" {% endif %} data-order="{{ loop.index0 }}" data-nav-item="{{ item.key }}" aria-haspopup="true" aria-expanded="false">{{
                    item.title }}
                    <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"
                        aria-hidden="true">
                        <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
                <div class="navbar__dropdown-menu navbar__dropdown-menu--left" aria-label="{{ item.title
                    }} sections">
                    <!-- Dropdown items specific to each main nav item -->
                    {% for anchor in item.anchors %}
                    <a href="{{ item.path + "#" + anchor.id }}" class="navbar__link">{{ anchor.title }}</a>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- Regular nav item -->
            <a href="{{ item.path }}" class="navbar__link navbar__item--{{ item.key }} {% if 'align' in item %}navbar__item--{{ item.align }}{% endif %}"
                {% if page.key==item.key %}aria-current="page" {% endif %} data-order="{{ loop.index0 }}"
                data-nav-item="{{ item.key }}">{{ item.title }}</a>
            {% endif %}
            {% endif %}
            {% endfor %}
            <!-- Embed canonical order for JS (locale agnostic keys) -->
            <script type="application/json" id="nav-order">{{ navOrder | dump | safe }}</script>
            <!-- More dropdown for collapsed navigation items -->
            <div class="navbar__dropdown navbar__dropdown--more">
                <button class="navbar__dropdown-toggle" aria-expanded="false" aria-haspopup="true"
                    aria-label="More navigation options">
                    More
                    <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"
                        aria-hidden="true">
                        <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </button>
                <div class="navbar__dropdown-menu navbar__dropdown-menu--right">
                    <!-- Collapsed navigation items will be moved here by JavaScript -->
                    {% set navOrder = [] %}
                    {% for item in navItems %}
                    {% if not item.hidden %}
                    {% set _ = navOrder.push(item.key) %}
                    <a href="{{ item.path }}" class="navbar__link navbar__item--{{ item.key }}" {% if page.key==item.key %}aria-current="page"
                        {% endif %} data-order="{{ loop.index0 }}" data-nav-item="{{ item.key }}">{{ item.title }}</a>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </nav>
        <div class="navbar__language" role="navigation" aria-label="Language switcher">
            <svg class="navbar__language-icon" xmlns="http://www.w3.org/2000/svg" width="27" height="27" viewBox="50 70 412 412" aria-hidden="true">
                <path
                    d="M349 149q3 25 3 43t-3 43h72q6 -23 6 -43t-6 -43h-72zM311 31q19 35 30 76h63q-16 -27 -39.5 -46.5t-53.5 -29.5zM306 149h-100q-3 23 -3 43t3 43h100q3 -25 3 -43t-3 -43zM256 22q-28 41 -41 85h82q-13 -44 -41 -85zM171 277h-63q16 27 39.5 46.5t53.5 29.5q-18 -33 -30 -76zM108 107h63q12 -43 30 -76q30 10 -53.5 29.5t-39.5 46.5zM91 149q-6 23 -6 43t6 43h72q-3 -25 -3 -43t3 -43h-72zM256 362q28 -41 41 -85h-82q13 44 41 85zM404 277h-63q-11 41 -30 76q30 -10 53.5 -29.5t39.5 -46.5zM256 405q-58 0 -107 -28.5t-77.5 -77.5t-28.5 -107q0 -42 16 -81.5t46 -69.5t69.5 -46t81.5 -16t81.5 16t69.5 46t46 69.5t16 81.5t-16 81.5t-46 69.5t-69.5 46t-81.5 16z" />
            </svg>
            {% for loc in alternates %}
            {% if page.routes[loc] %}
            <a data-lang="{{ loc }}" href="{{ page.routes[loc] }}" class="navbar__language-link {% if locale==loc %}current{% else
                %}alternate{% endif %}" aria-label="Switch to {{ loc | upper }} language">{{ loc | upper }}</a>
            {% endif %}
            {% endfor %}
        </div>
        <!-- Mobile menu toggle label -->
        <label for="navbar-mobile-toggle" class="navbar__mobile-toggle" aria-label="Toggle mobile menu">
            <span class="navbar__mobile-toggle-line"></span>
            <span class="navbar__mobile-toggle-line"></span>
            <span class="navbar__mobile-toggle-line"></span>
        </label>
    </header>

    <!-- Hidden checkbox for CSS-only mobile menu toggle -->
    <input type="checkbox" id="navbar-mobile-toggle" class="navbar__mobile-checkbox" hidden>
    
    <div class="navbar__mobile-menu" id="mobile-menu" aria-label="Mobile navigation menu">
        <div class="navbar__mobile-menu-header">
            <div class="navbar__mobile-menu-logo">
                CO₂
            </div>
            <!-- Close button that unchecks the checkbox -->
            <label for="navbar-mobile-toggle" class="navbar__mobile-menu-close" aria-label="Close mobile menu">✕</label>
        </div>

        <div class="navbar__mobile-language-selector">
            {% for loc in alternates %}
            {% if page.routes[loc] %}
            <span class="navbar__mobile-language" data-lang="{{ loc }}">{{ loc | upper }}</span>
            {% if not loop.last %}<span>|</span>{% endif %}
            {% endif %}
            {% endfor %}
        </div>

        <nav class="navbar__mobile-nav" aria-label="Mobile main navigation">
            {% for item in navItems %}
            {% if not item.hidden %}
            <div class="navbar__mobile-menu-section">

                <!-- Menu items that close the menu when clicked -->
                <a href="{{ item.path }}" class="navbar__mobile-menu-item-path navbar__mobile-menu-item navbar__item--{{ item.key }} {% if 'align' in item %}navbar__item--{{ item.align
                    }}{% endif %}" {% if page.key==item.key %}aria-current="page" {% endif %} data-order="{{ loop.index0 }}"
                    data-nav-item="{{ item.key }}">{{ item.title }}</a>
                {% if item.anchors %}
                <div class="navbar__mobile-dropdown-menu" aria-label="{{ item.title }} sections">
                    {% for anchor in item.anchors %}
                    <a href="{{ item.path + "#" + anchor.id }}" class="navbar__mobile-menu-item navbar__mobile-dropdown-item" onclick="document.getElementById('navbar-mobile-toggle').checked = false">{{ anchor.title }}</a>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endif %}
            {% endfor %}
        </nav>
    </div>
</div>
<script type="speculationrules">
{
  "prerender": [{
    "urls": ["/{{ locale }}/gcs", "/{{ locale }}/data", "/{{ locale }}/education"],
    "eagerness": "moderate"
  }],
  "prefetch": [
    {
      "where": { "selector_matches": "nav a" },
      "eagerness": "conservative"
    },
    {
      "where": { "href_matches": "/{{ locale }}/*" },
      "eagerness": "conservative"
    }
  ]
}
</script>
